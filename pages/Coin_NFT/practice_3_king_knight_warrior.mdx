# Practice 3: á»¨ng dá»¥ng OTW, Publisher vÃ  object display 
Trong ná»™i dung nÃ y mÃ¬nh sáº½ thiáº¿t káº¿ má»™t game cÃ³ cá»‘t truyá»‡n sau: 

**NhÃ  vua** sáº½ chá»n nhá»¯ng **chiáº¿n binh cÃ³ nÄƒng lá»±**c Ä‘á»ƒ thÄƒng chá»©c thÃ nh **hiá»‡p sÄ©**. ToÃ n bá»™ quÃ¡ trÃ¬nh cÃ³ thá»ƒ chia thÃ nh cÃ¡c Ä‘iá»ƒm sau:

- Chá»‰ cÃ³ **má»™t nhÃ  vua duy nháº¥t**, vÃ  vua cÃ³ thá»ƒ **nÃ¢ng cao nÄƒng lá»±c dÆ°á»›i sá»± hÆ°á»›ng dáº«n cá»§a Tháº§n (God aka lÃ  chÃºng ta admin)**
- Äiá»u kiá»‡n Ä‘á»ƒ **Ä‘Æ°á»£c thÄƒng chá»©c thÃ nh hiá»‡p sÄ© lÃ  nÄƒng lá»±c cá»§a chiáº¿n binh khÃ´ng Ä‘Æ°á»£c tháº¥p hÆ¡n nhÃ  vua**. Má»—i hiá»‡p sÄ©  cÃ³ giÃ¡ trá»‹ nÄƒng lá»±c cá»§a há» sáº½ dá»«ng láº¡i á»Ÿ táº¡i Ä‘Ã³ vÃ  khÃ´ng thá»ƒ cáº£i thiá»‡n thÃªm.

![](../assets/coin_nft/king.png)


NhÆ° váº­y liÃªn quan gÃ¬ Ä‘áº¿n OTW, publisher hay object display Ä‘Ãºng khÃ´ng? VÃ¬ ná»™i dung nÃ y dÃ nh cho beginners nÃªn má»¥c Ä‘Ã­ch lÃ  Ä‘á»ƒ cho cÃ¡c báº¡n khÃ´ng cáº£m tháº¥y nhÃ m chÃ¡n vÃ  dá»… hiá»ƒu. 


MÃ¬nh sáº½ giáº£i thÃ­ch má»™t chÃºt vá» lÃ½ thuyáº¿t:

## OTW 

One-time witness (OTW) lÃ  má»™t instance cá»§a má»™t kiá»ƒu Ä‘áº·c biá»‡t, viá»‡c Ä‘á»‹nh nghÄ©a nÃ³ yÃªu cáº§u cÃ¡c Ä‘iá»u kiá»‡n sau:

- TÃªn giá»‘ng vá»›i module nhÆ°ng pháº£i In hoa.
- CÃ³ duy nháº¥t drop ability

OTW chá»‰ Ä‘Æ°á»£c táº¡o trong module initializer vÃ  Ä‘Æ°á»£c Ä‘áº£m báº£o lÃ  duy nháº¥t, cÃ³ thá»ƒ sá»­ dá»¥ng `types::is_one_time_witness(&witness)` Ä‘á»ƒ xÃ¡c Ä‘á»‹nh witness Ä‘áº§u vÃ o cÃ³ pháº£i lÃ  *OTW* hay khÃ´ng. NhÆ° váº­y tá»« cÃ¢u chuyá»‡n king trÃªn thÃ¬ ta chá»‰ muá»‘n táº¡o má»™t **King** duy nháº¥t.


## Publisher 

Publisher lÃ  má»™t object Ä‘áº·c biá»‡t **quáº£n lÃ½ cÃ¡c quyá»n** trong system. NÃ³ hoáº¡t Ä‘á»™ng nhÆ° má»™t keeper ( gÃ¡c cá»•ng) , kiá»ƒm tra xem cÃ¡c pháº§n khÃ¡c nhau cá»§a code (modules vÃ  packages) cÃ³ Ä‘Æ°á»£c phÃ©p **lÃ m viá»‡c vá»›i nhau hay khÃ´ng**. Publisher thá»±c hiá»‡n Ä‘iá»u nÃ y báº±ng cÃ¡ch sá»­ dá»¥ng cÃ¡c lá»‡nh Ä‘áº·c biá»‡t nhÆ° `package::from_module<T>` vÃ  `package::from_package<T>` Ä‘á»ƒ xÃ¡c thá»±c cÃ¡c kiá»ƒu dá»¯ liá»‡u vÃ  má»‘i quan há»‡ giá»¯a chÃºng.

Äá»ƒ táº¡o má»™t Publisher, chÃºng ta cáº§n sá»­ dá»¥ng OTW (One-Time Witness) Ä‘Ã£ Ä‘á» cáº­p trÃªn Ä‘Ã³. CÃ³ hai cÃ¡ch Ä‘á»ƒ thá»±c hiá»‡n:

1. Sá»­ dá»¥ng `package::claim_and_keep(otw, ctx)` Ä‘á»ƒ táº¡o vÃ  ngay láº­p tá»©c chuyá»ƒn quyá»n sá»Ÿ há»¯u cho Publisher 
2. Hoáº·c sá»­ dá»¥ng `package::claim(otw, ctx)` Ä‘á»ƒ táº¡o Publisher trÆ°á»›c, dÃ¹ng nÃ³ cho cÃ¡c tÃ¡c vá»¥ khÃ¡c (nhÆ° thiáº¿t láº­p **object display**), sau Ä‘Ã³ thá»±c hiá»‡n chuyá»ƒn quyá»n sá»Ÿ há»¯u báº±ng lá»‡nh **transfer**. 

Trong ngá»¯ cáº£nh cÃ¢u chuyá»‡n mÃ  mÃ¬nh viáº¿t á»Ÿ trÃªn, Publisher giá»‘ng nhÆ° má»™t tháº¿ lá»±c tháº§n thÃ¡nh( GOD ğŸ˜‚)  cÃ³  quyá»n Ä‘áº·c biá»‡t - nÃ³ lÃ  thá»±c thá»ƒ duy nháº¥t cÃ³ k**háº£ nÄƒng giÃºp NhÃ  Vua trá»Ÿ nÃªn máº¡nh máº½ hÆ¡n vÃ  cáº£i thiá»‡n nÄƒng lá»±c.**


## Object display

Sau khi cÃ³ Publisher object, builder cÃ³ thá»ƒ dÃ¹ng `sui::display` module Ä‘á»ƒ customize cÃ¡c properties cho má»™t object báº±ng cÃ¡ch xá»­ lÃ½ data off-chain. MÃ¬nh láº¥y vÃ­ dá»¥ mÃ¬nh cÃ³ thá»ƒ thÃªm má»™t vÃ i thuá»™c tÃ­nh cho hero:

```rust
{
    "name": "{name}",
    "link": "https://sui-heroes.io/hero/{id}",
    "img_url": "ipfs://{img_url}",
    "description": "A true Hero of the Sui ecosystem!",
    "project_url": "https://sui-heroes.io",
    "creator": "Unknown Sui Fan"
}
```


## Demo example 

Äáº§u tiÃªn mÃ¬nh sáº½ táº¡o má»™t  king module. Bá»Ÿi vÃ¬ chá»‰ cÃ³ king duy nháº¥t nÃªn mÃ¬nh sáº½ cáº§n OTW Ä‘á»ƒ truyá»n witness vÃ o. VÃ  mÃ¬nh cÅ©ng dÃ¹ng publisher object Ä‘á»ƒ Ä‘áº£m báº£o King Ä‘Æ°á»£c Ä‘á»‹nh nghÄ©a trong cÃ¹ng má»™t package. 

```rust
module sui_hack_camp::king {
    use sui::object::{Self, UID};
    use sui::tx_context::{Self, TxContext};
    use sui::transfer;
    use sui::types;
    use sui::package::{Self, Publisher};

    const ENOTPACKAGE: u64 = 1;

    public struct King has key {
        id: UID,
        ability: u64,
    }

    public fun create_k<T: drop>(witness: T, ability: u64, ctx: &mut TxContext) {
			  
			  let king = King {
            id: object::new(ctx),
            ability,
        }

        transfer::transfer(king, ctx.sender());
    }

    entry fun upgrade_king_ability(publisher: &Publisher, king: &mut King) {
        // check publisher 
        assert!(package::from_package<King>(publisher), ENOTPACKAGE);
        
        king.ability = king.ability + 1;
    }
	
		// get ability cá»§a king 
    public fun get_ability(king: &King): u64 {
        king.ability
    }
}
```

Tiáº¿p theo lÃ  Warrior module, ai cÅ©ng cÃ³ thá»ƒ sá»¡ há»¯u cho mÃ¬nh má»™t con warrior. Tuy nhiÃªn Ä‘á»ƒ upgrade tá»« warrior lÃªn thÃ nh knight thÃ¬ warrior object sáº½ pháº£i bá»‹ removed Ä‘i. VÃ  khi thÃ nh knight, ta sáº½ handle cÃ¡c attributes má»›i cho nÃ³ ( nghe tÆ°Æ¡ng tá»± nhÆ° object display pháº£i khÃ´ng ğŸ‘€) . 

```rust
module 0x0::warrior {

    use std::string::String;

    public struct Warrior has key {
        id: UID,
        name: String, 
        ability: u64
    }


    entry fun create_w(name: String, ability: u64, ctx: &mut TxContext) {
        
        // same vá»›i king 
        let warrior = Warrior {
            id: object::new(ctx),
            name,
            ability,
        }
        
        transfer::transfer(warrior, ctx.sender());
    }

    entry fun upgrade_ability_warrior(warrior: &mut Warrior) {
        warrior.ability = warrior.ability + 1;
    }


    public fun remove_warrior(warror: Warrior): (String, u64){
        let Warrior {id, name, ability} = warror;
        object::delete(id);
        
        (name, ability)

    }

}
```

Tiáº¿p theo lÃ  vá» `knight` module, 

- Sá»­ dá»¥ng **OTW Ä‘á»ƒ táº¡o Publisher,** sau Ä‘Ã³ dÃ¹ng **Publisher Ä‘á»ƒ táº¡o Display object**. Display object **cho phÃ©p ta Ä‘á»‹nh nghÄ©a cÃ¡c thuá»™c tÃ­nh (keys vÃ  values) cho Knight**. Ta cÃ³ thá»ƒ thay Ä‘á»•i cÃ¡c thuá»™c tÃ­nh nÃ y báº±ng cÃ¡c hÃ m **add_multiple, edit, remove vÃ  update_versionâ€¦..**
- Sau khi Ä‘Æ°á»£c thÄƒng chá»©c thÃ nh Knight, object sáº½ khÃ´ng thá»ƒ thay Ä‘á»•i Ä‘Æ°á»£c ná»¯a, vÃ¬ váº­y ta sá»­ dá»¥ng **freeze_object** Ä‘á»ƒ chuyá»ƒn quyá»n sá»Ÿ há»¯u thÃ nh immutable shared.

```rust
module 0x0::knight {
	 
    use sui::package;
    use sui::display;
    use sui::url::Url;
	  

    public struct KNIGHT has drop {}

    public struct Knight has key {
        id: UID,
        name: String,
        ability: u64,
        image_url: Url
    }

    fun init(otw: KNIGHT, ctx: &mut TxContext) {
        let keys = vector[
            string::utf8(b"name is"),
            string::utf8(b"ability is"),
        ];

        let values = vector[
            string::utf8(b"{name}"),
            string::utf8(b"{ability}"),
        ];

        let publisher = package::claim(otw, ctx);
				
        let display = display::new_with_fields<Knight>(&publisher, keys, values, ctx);
        
        display::update_version(&mut display);

	      transfer::public_transfer(publisher, ctx.sender());
        transfer::public_transfer(display, ctx.sender());
    }

    public fun create_knight(name: String, ability: u64, ctx: &mut TxContext) {
        let knight = Knight {
            id: object::new(ctx),
            name,
            ability,
            image_url: url::new_unsafe_from_bytes(b"link o day nha")
        };
        
        transfer::freeze_object(knight);
    }
}

```

BÃ¢y giá» mÃ¬nh  viáº¿t má»™t hÃ m main Ä‘á»ƒ khá»Ÿi táº¡o `King` object.  Khi thÄƒng chá»©c, há»‡ thá»‘ng sáº½ kiá»ƒm tra giÃ¡ trá»‹ nÄƒng lá»±c. Náº¿u Ä‘áº¡t yÃªu cáº§u, thÃ´ng tin tá»« warrior object sáº½ Ä‘Æ°á»£c phÃ¢n giáº£i Ä‘á»ƒ táº¡o knight má»›i.

```rust 
module king_knight::test {
    use sui::tx_context::TxContext;

    use king_knight::warrior::{Self, Warrior};
    use king_knight::king::{Self, King};
    use king_knight::knight::create_knight;

    const ENOTENOUGHABILITY: u64 = 0;

    struct TEST has drop {}

    fun init(otw: TEST, ctx: &mut TxContext) {
        king::create_king(otw, ctx);
    }

    entry fun upgrade_to_knight(warrior: Warrior, king: &King, ctx: &mut TxContext) {
        assert!(warrior::get_ability(&warrior) >= king::get_ability(king), ENOTENOUGHABILITY);
       
        let (name, ability) = warrior::destroy(warrior);
        create_knight(name, ability, ctx);
    }
}
```


## function call 

Sau khi cháº¡y `sui client publish`: 


```
â•­â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•®
â”‚ Object Changes                                                                                                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Created Objects:                                                                                                          â”‚
â”‚  â”Œâ”€â”€                                                                                                                      â”‚
â”‚  â”‚ ObjectID: 0x17cc0568b5a938b373761f43eb0c00d6c7dff2823e28e4925fab95bea45469d0                                           â”‚
â”‚  â”‚ Sender: 0x915c2d19ee5fde257693f25e6c2cabb04c25e7ae03932817d52e122258c88ddb                                             â”‚
â”‚  â”‚ Owner: Account Address ( 0x915c2d19ee5fde257693f25e6c2cabb04c25e7ae03932817d52e122258c88ddb )                          â”‚
â”‚  â”‚ ObjectType: 0x2::display::Display<0x5d8407c16e0f499e019d24b539ae44d9985d6968a2c219fc277ad620d869ad38::knight::Knight>  â”‚
â”‚  â”‚ Version: 289571546                                                                                                     â”‚
â”‚  â”‚ Digest: 2WJ4rJDHSV2DiwxnTNEKnpBJt4PpPoeZo2ojYNrKipqi                                                                   â”‚
â”‚  â””â”€â”€                                                                                                                      â”‚
â”‚  â”Œâ”€â”€                                                                                                                      â”‚
â”‚  â”‚ ObjectID: 0x81aab895a39e53a0c90a359e3dc42b308c724d2a837c92ab0a8c43b627b30aaf                                           â”‚
â”‚  â”‚ Sender: 0x915c2d19ee5fde257693f25e6c2cabb04c25e7ae03932817d52e122258c88ddb                                             â”‚
â”‚  â”‚ Owner: Account Address ( 0x915c2d19ee5fde257693f25e6c2cabb04c25e7ae03932817d52e122258c88ddb )                          â”‚
â”‚  â”‚ ObjectType: 0x2::package::UpgradeCap                                                                                   â”‚
â”‚  â”‚ Version: 289571546                                                                                                     â”‚
â”‚  â”‚ Digest: ExT896choz8h5aNwgifjv5jwkrCcEFVmRwykZRKojXvz                                                                   â”‚
â”‚  â””â”€â”€                                                                                                                      â”‚
â”‚  â”Œâ”€â”€                                                                                                                      â”‚
â”‚  â”‚ ObjectID: 0xc619a369d28c5ce668967cac2575ac3ed332fd96d7bffeb8c62a8bb10b18f8cf                                           â”‚
â”‚  â”‚ Sender: 0x915c2d19ee5fde257693f25e6c2cabb04c25e7ae03932817d52e122258c88ddb                                             â”‚
â”‚  â”‚ Owner: Account Address ( 0x915c2d19ee5fde257693f25e6c2cabb04c25e7ae03932817d52e122258c88ddb )                          â”‚
â”‚  â”‚ ObjectType: 0x5d8407c16e0f499e019d24b539ae44d9985d6968a2c219fc277ad620d869ad38::king::King                             â”‚
â”‚  â”‚ Version: 289571546                                                                                                     â”‚
â”‚  â”‚ Digest: Fy2k4FvcBF469pGpZPBPJVT29fZFbZ4yYJupfDaKRZLj                                                                   â”‚
â”‚  â””â”€â”€                                                                                                                      â”‚
â”‚  â”Œâ”€â”€                                                                                                                      â”‚
â”‚  â”‚ ObjectID: 0xe1cb332e72b2a48ae03d683cf9cc0b88b3e21a0e21e7048bd07b781dbe603807                                           â”‚
â”‚  â”‚ Sender: 0x915c2d19ee5fde257693f25e6c2cabb04c25e7ae03932817d52e122258c88ddb                                             â”‚
â”‚  â”‚ Owner: Account Address ( 0x915c2d19ee5fde257693f25e6c2cabb04c25e7ae03932817d52e122258c88ddb )                          â”‚
â”‚  â”‚ ObjectType: 0x2::package::Publisher                                                                                    â”‚
â”‚  â”‚ Version: 289571546                                                                                                     â”‚
â”‚  â”‚ Digest: CNfVMZLb1yTbKhhT3xMGhCh2azNN9QhPyji49tpmVdVg                                                                   â”‚
â”‚  â””â”€â”€                                                                                                                      â”‚
â”‚ Mutated Objects:                                                                                                          â”‚
â”‚  â”Œâ”€â”€                                                                                                                      â”‚
â”‚  â”‚ ObjectID: 0x0efa2a3fe2b5989323a8fb199abeaeda5e3d7323ffc5e040629886ddcc0d9679                                           â”‚
â”‚  â”‚ Sender: 0x915c2d19ee5fde257693f25e6c2cabb04c25e7ae03932817d52e122258c88ddb                                             â”‚
â”‚  â”‚ Owner: Account Address ( 0x915c2d19ee5fde257693f25e6c2cabb04c25e7ae03932817d52e122258c88ddb )                          â”‚
â”‚  â”‚ ObjectType: 0x2::coin::Coin<0x2::sui::SUI>                                                                             â”‚
â”‚  â”‚ Version: 289571546                                                                                                     â”‚
â”‚  â”‚ Digest: 4W3QmwbfeF2wKE5AXg4Bj8f5BnpSdfVxHkkcePumEixt                                                                   â”‚
â”‚  â””â”€â”€                                                                                                                      â”‚
â”‚ Published Objects:                                                                                                        â”‚
â”‚  â”Œâ”€â”€                                                                                                                      â”‚
â”‚  â”‚ PackageID: 0x5d8407c16e0f499e019d24b539ae44d9985d6968a2c219fc277ad620d869ad38                                          â”‚
â”‚  â”‚ Version: 1                                                                                                             â”‚
â”‚  â”‚ Digest: GL2nCkw98Zp6zoi4fUd54i9HeS1Ke6a2fZxyabBE2jeM                                                                   â”‚
â”‚  â”‚ Modules: interact, king, knight, warrior                                                                               â”‚
â”‚  â””â”€â”€                                                                                                                      â”‚
â•°â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•¯
```

MÃ¬nh sau Ä‘Ã³ sáº½ export cÃ¡c values Ä‘á»ƒ dá»… call hÆ¡n: 
```bash
export PACKAGE_ID=???
export PUBLISHER=??
export KING=??

---
vÃ­ dá»¥: 
---
export PACKAGE_ID=0x5d8407c16e0f499e019d24b539ae44d9985d6968a2c219fc277ad620d869ad38 
export PUBLISHER=0xe1cb332e72b2a48ae03d683cf9cc0b88b3e21a0e21e7048bd07b781dbe603807
export KING=0xc619a369d28c5ce668967cac2575ac3ed332fd96d7bffeb8c62a8bb10b18f8cf
```

Báº¡n cÃ³ thá»ƒ sá»­ dá»¥ng `sui client object $KING` Ä‘á»ƒ xem thá»­ king nhÃ©. CÃ¡c function sau báº¡n hÃ£y xem á»Ÿ trong video nhÃ©. 

