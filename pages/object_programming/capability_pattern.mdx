# Capability Pattern cho Object Authorization

+ Capability lÃ  má»™t kiá»ƒu pattern trong ngÃ´n ngá»¯ láº­p trÃ¬nh Move. 
+ NÃ³ giÃºp kiá»ƒm soÃ¡t viá»‡c ai Ä‘Æ°á»£c phÃ©p sá»­ dá»¥ng cÃ¡c objects trong chÆ°Æ¡ng trÃ¬nh. Láº¥y vÃ­ dá»¥ mÃ¬nh muá»‘n táº¡o má»™t quyá»n teacher object mÃ  chá»‰ cÃ³ object Ä‘Ã³ má»›i cÃ³ quyá»n quyá»n thay Ä‘á»•i báº£ng Ä‘iá»ƒm há»c sinh. . 

+ Khi muá»‘n táº¡o má»™t capability object mÃ  khÃ´ng thá»ƒ chuyá»ƒn cho ngÆ°á»i khÃ¡c( giá»‘ng nhÆ° soulbound token) , chÃºng ta chá»‰ cáº§n bá» qua thuá»™c tÃ­nh store trong struct.

```rust
struct TeacherCap has key {
    id: UID
  }
```

ğŸ’¡Note: CÃ¡ch lÃ m nÃ y giá»‘ng vá»›i cÃ¡ch táº¡o soulbound tokens (SBT) trong Move - báº¡n chá»‰ cáº§n táº¡o má»™t struct cÃ³ thuá»™c tÃ­nh key mÃ  khÃ´ng cÃ³ thuá»™c tÃ­nh store..

Sau khi sá»Ÿ há»¯u Object `TeacherCap` thÃ¬ ta cÃ³ thá»ƒ dÃ¹ng trong function Ä‘á»ƒ báº¥t ká»³ ai cÃ³ object Ä‘Ã³ má»›i cÃ³ thá»ƒ gá»i Ä‘Æ°á»£c:

```rust
public fun create_wrappable_transcript_object(_: &TeacherCap, history: u8, math: u8, literature: u8, ctx: &mut TxContext) {
    let wrappableTranscript = WrappableTranscript {
        id: object::new(ctx),
        history,
        math,
        literature,
    };
    
    
    transfer::transfer(wrappableTranscript, tx_context::sender(ctx))
}
```

ChÃºng ta truyá»n tham sá»‘ vá»›i reference cá»§a object `TeacherCap` Ä‘Ã³ vÃ  dÃ¹ng underscore(_) Ä‘á»ƒ kÃ½ hiá»‡u lÃ  tham sá»‘ nÃ y khÃ´ng Ä‘Æ°á»£c sá»­ dá»¥ng. Nhá»› lÃ  báº¡n chá»‰ Ä‘ang tham chiáº¿u Ä‘Ã³ tá»›i object.


-> NhÆ° váº­y má»i ngÆ°á»i Ä‘Ã£ hiá»ƒu táº§m quan trá»ng cá»§a viá»‡c dÃ¹ng Capability ráº¥t quan trá»ng cho quyá»n access control vá»›i cÃ¡c object. Pattern nÃ y sáº½ cung cáº¥p má»™t cÃ¡ch flexible há»£n. Náº¿u báº¡n váº«n chÆ°a hiá»ƒu Capability lÃ  gÃ¬ ? 

ThÃ¬ báº¡n cÃ³ thá»ƒ coi nÃ³ giá»‘ng nhÆ° báº¡n muá»‘n vÃ o cá»­a nhÃ  thÃ¬ báº¡n pháº£i cÃ³ chÃ¬a khoÃ¡(key) , capability object sáº½ giá»‘ng nhÆ° chÃ¬a khoÃ¡ cá»§a báº¡n cáº¥p quyá»n Ä‘á»ƒ báº¡n cÃ³ thá»ƒ vÃ o Ä‘Æ°á»£c nhÃ ( truy cáº­p vÃ  thá»±c thi cÃ¡c function Ä‘Æ°á»£c) 


## Address check vÃ  sá»­ dá»¥ng Capability thÃ¬ nÃªn dÃ¹ng cÃ¡i gÃ¬ ? 

Khi láº­p trÃ¬nh blockchain, viá»‡c sá»­ dá»¥ng objects nhÆ° capabilities lÃ  má»™t khÃ¡i niá»‡m khÃ¡ má»›i vá»›i cÃ¡c báº¡n bá»Ÿi vÃ¬ á»Ÿ cÃ¡c ngÃ´n ngá»¯ smart contract khÃ¡c, viá»‡c xÃ¡c thá»±c nÃ y thÆ°á»ng Ä‘Æ°á»£c thá»±c hiá»‡n báº±ng cÃ¡ch check Ä‘á»‹a chá»‰ cá»§a ngÆ°á»i gá»­i. Kiá»ƒu:

```rust
if(address) { //code nÃ¨ }
```

Pattern nhÆ° tháº¿  cÅ©ng cÃ³ thá»ƒ Ã¡p dá»¥ng trong Sui, tuy nhiÃªn viá»‡c báº¡n sá»­ dá»¥ng capability objects Ä‘Æ°á»£c khuyáº¿n khÃ­ch hÆ¡n vÃ¬ tÃ­nh báº£o máº­t vÃ  code sáº½ Ä‘Æ°á»£c tá»• chá»©c tá»‘t hÆ¡n.

```rust
// VÃ­ dá»¥ náº¿u dÃ¹ng kiá»ƒu address check 
public fun new(ctx: &mut TxContext): User {
    assert!(ctx.sender() == APPLICATION_ADMIN, ENotAuthorized);
    User { id: object::new(ctx) }
}


// cÃ²n khi dÃ¹ng Capability pattern 

public fun new(_: &AdminCap, ctx: &mut TxContext): User {
    User { id: object::new(ctx) }
}

```

NhÆ° váº­y báº¡n sáº½ tháº¥y sá»­ dá»¥ng capabilities cÃ³ nhiá»u Æ°u Ä‘iá»ƒm:

- Quáº£n lÃ½ quyá»n dá»… dÃ ng hÆ¡n vÃ¬ chÃºng Ä‘á»u lÃ  objects.
- YÃªu cáº§u rÃµ rÃ ng cáº§n cÃ³ **AdminCap**.
- KhÃ´ng cáº§n kiá»ƒm tra thÃªm trong function body, giáº£m kháº£ nÄƒng dev máº¯c lá»—i.
- Capabilities giÃºp dá»… dÃ ng kiá»ƒm tra quyá»n háº¡n, vÃ¬ ngÆ°á»i dÃ¹ng cÃ³ thá»ƒ xem quyá»n admin cá»§a há» thÃ´ng qua vÃ­ hoáº·c trÃ¬nh duyá»‡t, minh báº¡ch hÆ¡n so vá»›i viá»‡c check Ä‘á»‹a chá»‰.

## Code vÃ­ dá»¥: 

### Step 1: Táº¡o thÃªm 1 address má»›i (cáº§n 2 account) 

```bash
sui client new-address ed25519
â•­â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•®
â”‚ Created new keypair and saved it to keystore.                                               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ alias          â”‚ friendly-agates                                                            â”‚
â”‚ address        â”‚ 0x75fc542f5292e636856d2b72dae9831a20747c3876da16cfa4b5f4a31f909e19         â”‚
â”‚ keyScheme      â”‚ ed25519                                                                    â”‚
â”‚ recoveryPhrase â”‚ trash rigid enlist law state aspect blanket stadium material frog cost zoo â”‚
â•°â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•¯
```

Sau Ä‘Ã³ nhá»› switch sang address khÃ¡c: 

```bash
sui client switch --address friendly-agates 

//hoac la 
---
sui client switch --address 0x75fc542f5292e636856d2b72dae9831a20747c3876da16cfa4b5f4a31f909e19

// nho dung lenh nay de co coin ( neu ban dang o devnet / testnet)  
sui client faucet 
--- 
```

MÃ¬nh sáº½ táº¡o má»™t Ä‘oáº¡n code sau trong sui bootcamp cho nhá»¯ng ai lÃ  há»c sinh: 
```rust
module hack_camp::sui_bootcamp_2024 {
		
		use sui::object::{Self, UID};
		use sui::tx_context;
		use std::string::String;
		use sui::transfer;
		
    public struct Student has key {
        id: UID,
        name: String,
    }

		/// quyá»n admin má»›i táº¡o má»™t sudent 
    public struct AdminCap has key, store { id: UID }

    /// Táº¡o admin khi publish contract
    fun init(ctx: &mut TxContext) {
        transfer::transfer(
            AdminCap { id: object::new(ctx) },
            ctx.sender()
        )
    }
    
    /// Táº¡o student 
    public entry fun new(_: &AdminCap, name: String, ctx: &mut TxContext) {
        let student = Student {
            id: object::new(ctx),
            name,
        };

        transfer::transfer(student, ctx.sender());
    }
}
```

Sau Ä‘Ã³ mÃ¬nh cháº¡y lá»‡nh nÃ y: 


```bash
sui client publish --gas-budget 100000000

// result
---
â•­â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•®
â”‚ Object Changes                                                                                                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Created Objects:                                                                                                â”‚
â”‚  â”Œâ”€â”€                                                                                                            â”‚
â”‚  â”‚ ObjectID: 0x3ec71eca91997e8238777350975a89f3efdec5201ef071c7d9691b53bf00e2ca                                 â”‚
â”‚  â”‚ Sender: 0x75fc542f5292e636856d2b72dae9831a20747c3876da16cfa4b5f4a31f909e19                                   â”‚
â”‚  â”‚ Owner: Account Address ( 0x75fc542f5292e636856d2b72dae9831a20747c3876da16cfa4b5f4a31f909e19 )                â”‚
â”‚  â”‚ ObjectType: 0x2::package::UpgradeCap                                                                         â”‚
â”‚  â”‚ Version: 268743481                                                                                           â”‚
â”‚  â”‚ Digest: 9ti8ZYN4iy8NVbsD1GD9TM6Y38EDE4hynj7gtR6e8b4Y                                                         â”‚
â”‚  â””â”€â”€                                                                                                            â”‚
â”‚  â”Œâ”€â”€                                                                                                            â”‚
â”‚  â”‚ ObjectID: 0xfa1ae2e11ddbb8ee31d47468d29d464b431d7d998ac2bc63644fee4f125c717b                                 â”‚
â”‚  â”‚ Sender: 0x75fc542f5292e636856d2b72dae9831a20747c3876da16cfa4b5f4a31f909e19                                   â”‚
â”‚  â”‚ Owner: Account Address ( 0x75fc542f5292e636856d2b72dae9831a20747c3876da16cfa4b5f4a31f909e19 )                â”‚
â”‚  â”‚ ObjectType: 0x9652d22c7183cee34849c6ef9520396681616fd7e3a3bc681aa6baa1b65fc3e7::sui_bootcamp_2024::AdminCap  â”‚
â”‚  â”‚ Version: 268743481                                                                                           â”‚
â”‚  â”‚ Digest: G39z2SECBcV37UpLFw4hokPhMsUzxAEXYmmxQjmMMyGj                                                         â”‚
â”‚  â””â”€â”€                                                                                                            â”‚
â”‚ Mutated Objects:                                                                                                â”‚
â”‚  â”Œâ”€â”€                                                                                                            â”‚
â”‚  â”‚ ObjectID: 0xcb6cef9e8ee4b99267971d9dae7023ee807e09c1709898ef2307a882b553d442                                 â”‚
â”‚  â”‚ Sender: 0x75fc542f5292e636856d2b72dae9831a20747c3876da16cfa4b5f4a31f909e19                                   â”‚
â”‚  â”‚ Owner: Account Address ( 0x75fc542f5292e636856d2b72dae9831a20747c3876da16cfa4b5f4a31f909e19 )                â”‚
â”‚  â”‚ ObjectType: 0x2::coin::Coin<0x2::sui::SUI>                                                                   â”‚
â”‚  â”‚ Version: 268743481                                                                                           â”‚
â”‚  â”‚ Digest: 5eMBHr3XVqhQTcuprphASG1KFUziPysNSBUfpmZ9Ld7u                                                         â”‚
â”‚  â””â”€â”€                                                                                                            â”‚
â”‚ Published Objects:                                                                                              â”‚
â”‚  â”Œâ”€â”€                                                                                                            â”‚
â”‚  â”‚ PackageID: 0x9652d22c7183cee34849c6ef9520396681616fd7e3a3bc681aa6baa1b65fc3e7                                â”‚
â”‚  â”‚ Version: 1                                                                                                   â”‚
â”‚  â”‚ Digest: HSEUeTrXDvQT4m1uKGGsouutUjVeUxVkPNf1txLDR9hz                                                         â”‚
â”‚  â”‚ Modules: sui_bootcamp_2024                                                                                   â”‚
â”‚  â””â”€â”€                                                                                                            â”‚
â•°â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•¯
```


![](../assets/Objects/access_control_ex1.png)




```
// Call the contract
sui client call --package 0x9652d22c7183cee34849c6ef9520396681616fd7e3a3bc681aa6baa1b65fc3e7 \
--module sui_bootcamp_2024 --function new \
--args 0xfa1ae2e11ddbb8ee31d47468d29d464b431d7d998ac2bc63644fee4f125c717b "hien" \
--gas-budget 100000000



```


![](../assets/Objects/access_control_ex2.png)

NhÆ° váº­y Ä‘Ã£ thÃ nh cÃ´ng, nhÆ°ng náº¿u báº¡n dÃ¹ng má»™t account khÃ¡cvaf call function thÃ¬ sáº½ bá»‹ bÃ¡o lá»—i 



MÃ¬nh sáº½ cÃ³ má»™t challenge Ä‘á»ƒ cÃ¡c báº¡ cÃ³ thá»ƒ luyá»‡n táº­p nhÆ° sau: Báº¡n sáº½ táº¡o má»™t há»‡ thá»‘ng quáº£n lÃ½ Ä‘iá»ƒm há»c sinh vá»›i cÃ¡c chá»©c nÄƒng:
1. Táº¡o má»™t `TeacherCap` Ä‘á»ƒ chá»‰ giÃ¡o viÃªn má»›i cÃ³ quyá»n thay Ä‘á»•i Ä‘iá»ƒm
2. Struct `Student` cáº§n cÃ³ cÃ¡c thÃ´ng tin: id, name vÃ  grade
3. Chá»‰ ngÆ°á»i cÃ³ `TeacherCap` má»›i cÃ³ thá»ƒ:
- Táº¡o má»›i há»c sinh
- Cáº­p nháº­t Ä‘iá»ƒm cho há»c sinh

hint:

```rust

module sui_bootcamp::grade_management {

    use sui::object::{Self, UID};
    use sui::tx_context::{Self, TxContext};
    use sui::transfer;
    use std::string::String;

    struct TeacherCap has key { 
        id: UID 
    }

    struct Student has key, store {
        id: UID,
        // define here 
    }

    // TODO: Implement functions:
    // 1. init()
    // 2. new_student()
    // 3. update_grade()
}
```

YÃªu cáº§u chi tiáº¿t:
1. HoÃ n thiá»‡n cÃ¡c functions cÃ²n thiáº¿u
2. Äáº£m báº£o chá»‰ TeacherCap má»›i cÃ³ quyá»n táº¡o vÃ  cáº­p nháº­t thÃ´ng tin



## Náº¿u muá»‘n thÃªm má»™t admin ná»¯a cho má»™t Ä‘á»‹a chá»‰ khÃ¡c thÃ¬ lÃ m sao?
ThÃ¬ báº¡n cÃ³ thá»ƒ viáº¿t má»™t function Ä‘á»ƒ gá»­i 1 object AdminCap cho ngÆ°á»i Ä‘Ã³. VÃ­ dá»¥ náº¿u mÃ¬nh muá»‘n cÃ³ thÃªm má»™t giÃ¡o viÃªn ná»¯a thÃ¬: 
```rust 

    public fun add_additional_teacher(_: &TeacherCap, new_teacher_address: address, ctx: &mut TxContext){
        transfer::transfer(
            TeacherCap {
                id: object::new(ctx)
            },
        new_teacher_address
        )
    }

```