# Object Wrapping

Trong bÃ i há»c trÆ°á»›c báº¡n Ä‘Ã£ há»c vá» cÃ¡c loáº¡i objects trong Sui.

Trong Sui Move, báº¡n cÃ³ thá»ƒ lá»“ng cÃ¡c data structure vÃ o nhau thÃ´ng qua ká»¹ thuáº­t gá»i lÃ  wrapping. Giá»‘ng nhÆ° cÃ¡ch báº¡n Ä‘á»ƒ Ä‘á»“ váº­t vÃ o trong má»™t chiáº¿c há»™p, báº¡n cÃ³ thá»ƒ Ä‘áº·t má»™t `struct` vÃ o bÃªn trong má»™t struct khÃ¡c. VÃ­ dá»¥:

```rust
public struct Foo has key {
    id: UID,
    bar: Bar,
}

public struct Bar has key, store {
    id: UID,
    value: u64,
}
```

PhÃ¢n tÃ­ch vÃ­ dá»¥ trÃªn:

+ Äá»ƒ má»™t struct trá»Ÿ thÃ nh má»™t object  Sui, nÃ³ cáº§n cÃ³ `key` abilities. 
+ Khi  Ä‘áº·t má»™t object Sui kiá»ƒu `Bar` vÃ o trong má»™t Ä‘á»‘i tÆ°á»£ng Sui kiá»ƒu `Foo`, kiá»ƒu Ä‘á»‘i tÆ°á»£ng `Foo` bá»c(wrapper) kiá»ƒu Ä‘á»‘i tÆ°á»£ng `Bar`. 
+ Kiá»ƒu Ä‘á»‘i tÆ°á»£ng `Foo` Ä‘Æ°á»£c gá»i lÃ  **Ä‘á»‘i tÆ°á»£ng bá»c hoáº·c Ä‘á»‘i tÆ°á»£ng bao bá»c(  wrapping object.)** .




Khi báº¡n wrap má»™t object, nÃ³ sáº½ trá»Ÿ thÃ nh **má»™t pháº§n dá»¯ liá»‡u cá»§a wrapping object Ä‘Ã³**. Äiá»u nÃ y cÃ³ nghÄ©a lÃ  chÃºng ta khÃ´ng thá»ƒ tÃ¬m kiáº¿m nÃ³ thÃ´ng qua ID riÃªng cá»§a nÃ³, vÃ  báº¡n cÅ©ng khÃ´ng thá»ƒ truyá»n wrapped object nhÆ° má»™t tham sá»‘ trong cÃ¡c giao dá»‹ch blockchain. **CÃ¡ch duy nháº¥t Ä‘á»ƒ truy cáº­p wrapped object** lÃ  thÃ´ng qua object Ä‘ang wrap nÃ³ thÃ´i. 

Tuy nhiÃªn chÃºng ta khÃ´ng thá»ƒ táº¡o tÃ¬nh huá»‘ng sau:  Object A wrap object B, B wrap C, vÃ  C láº¡i wrap A ğŸ« . Äiá»u nÃ y sáº½ dáº«n Ä‘áº¿n sá»± phá»©c táº¡p vÃ  gÃ¢y ra cÃ¡c váº¥n Ä‘á» trong code cá»§a chÃ­nh mÃ¬nh.

Báº¡n cÃ³ thá»ƒ "unwrap" (thÃ¡o gá»¡) wrapped object. Khi unwrap, nÃ³ sáº½ trá»Ÿ thÃ nh má»™t object Ä‘á»™c láº­p trá»Ÿ láº¡i vÃ  cÃ³ thá»ƒ Ä‘Æ°á»£c truy cáº­p trá»±c tiáº¿p trÃªn blockchain. Object váº«n giá»¯ nguyÃªn ID duy nháº¥t mÃ  nÃ³ cÃ³ trÆ°á»›c khi Ä‘Æ°á»£c wrap.

Váº­y dÆ°á»›i Ä‘Ã¢y lÃ  má»™t sá»‘ cÃ¡ch Ä‘á»ƒ wrap( bá»c) láº¡i má»™t object vÃ o má»™t object khÃ¡c:

+ Direct Wrapping
+ Wrapping thÃ´ng qua `Option`
+ Wrapping thÃ´ng qua vector

## Direct wrapping ( Bá»c trá»±c tiáº¿p)

Náº¿u báº¡n Ä‘áº·t má»™t Sui object trá»±c tiáº¿p nhÆ° má»™t field trong má»™t Sui object khÃ¡c, nÃ³ Ä‘Æ°á»£c gá»i lÃ  **direct wrapping** (bá»c trá»±c tiáº¿p). Vá»›i kiá»ƒu wrap nÃ y, object Ä‘Æ°á»£c bá»c khÃ´ng thá»ƒ Ä‘Æ°á»£c unwrap (thÃ¡o gá»¡) trá»« khi object Ä‘Æ°á»£c bá»c nÃ³ bá»‹ phÃ¡ há»§y. CÃ¡ch nÃ y thÆ°á»ng Ä‘Æ°á»£c dÃ¹ng Ä‘á»ƒ khÃ³a cÃ¡c object vá»›i quyá»n truy cáº­p háº¡n cháº¿.  

HÃ£y xem má»™t vÃ­ dá»¥. Giáº£ sá»­ báº¡n cÃ³ má»™t loáº¡i object kiá»ƒu NFT trong Sui gá»i lÃ  `Object`, vá»›i cÃ¡c thuá»™c tÃ­nh nhÆ° `scarcity` (Ä‘á»™ hiáº¿m) vÃ  `style` (phong cÃ¡ch). 

Äá»ƒ Ä‘áº£m báº£o cÃ´ng báº±ng, báº¡n cáº§n cháº¯c cháº¯n ráº±ng Ä‘á»™ hiáº¿m pháº£i giá»‘ng nhau vÃ  chá»‰ khÃ¡c nhau vá» phong cÃ¡ch. Äiá»u nÃ y lÃ  vÃ¬ giÃ¡ trá»‹ cá»§a **NFT sáº½ cao hÆ¡n náº¿u nÃ³ cÃ³ Ä‘á»™ hiáº¿m cao hÆ¡n**. ÄÃ¢y lÃ  vÃ­ dá»¥: 

```rust
// Object  
public struct Object has key, store {
    id: UID,
    scarcity: u8,
    style: u8,
}

public entry fun create_object(scarcity: u8, style: u8, ctx: &mut TxContext) {
    let object = Object {
        id: object::new(ctx),
        scarcity,
        style,
    };
    transfer::transfer(object, tx_context::sender(ctx));
}
```

Trong Ä‘oáº¡n code trÃªn chÃºng ta sáº½ táº¡o ra má»™t object báº±ng function `create_object` . Báº¥t kÃ¬ ai cÅ©ng cÃ³ thá»ƒ call function nÃ y vÃ   created object sáº½ gá»­i tá»›i ngÆ°á»i kÃ­ transaction Ä‘Ã³. Bá»Ÿi vÃ¬ chá»‰ chá»§ sá»Ÿ há»¯u object má»›i cÃ³ thá»ƒ gá»­i transaction Ä‘á»ƒ thay Ä‘á»•i object Ä‘Ã³. Do Ä‘Ã³ náº¿u ai muá»‘n change object há» cáº§n pháº£i gá»­i Ä‘áº¿n má»™t bÃªn thá»© 3( third party)  nhÆ° web3 swap khÃ¡c. NhÆ° váº­y Ä‘á»ƒ Ä‘áº£m báº£o báº¡n váº«n giá»¯ quyá»n kiá»ƒm soÃ¡t cÃ¡c object cá»§a mÃ¬nh (nhÆ° coins vÃ  NFT) vÃ  khÃ´ng giao quyá»n kiá»ƒm soÃ¡t hoÃ n toÃ n cho bÃªn thá»© ba, báº¡n cáº§n sá»­ dá»¥ng ká»¹ thuáº­t direct wrapping nhÆ° sau:

```rust
public struct ObjectWrapper has key {
    id: UID,
    original_owner: address,
    to_swap: Object,
    fee: Balance<SUI>,
}
```

Object `ObjectWrapper` wrap object Ä‘á»ƒ swap:

```rust
public entry fun request_swap(object: Object, fee: Coin<SUI>, service_address: address, ctx: &mut TxContext) {   
    let wrapper = ObjectWrapper {
        id: object::new(ctx),
        original_owner: tx_context::sender(ctx),
        to_swap: object,
        fee: coin::into_balance(fee),
    };
    
    transfer::transfer(wrapper, service_address);
}
```

Trong function nÃ y, object cáº§n Ä‘Æ°á»£c swap Ä‘Æ°á»£c wrap báº±ng `ObjectWrapper`, vÃ  má»™t khoáº£n fee Ä‘Æ°á»£c chá»‰ Ä‘á»‹nh. Wrapper sau Ä‘Ã³ Ä‘Æ°á»£c gá»­i Ä‘áº¿n service address 
Äiá»u quan trá»ng á»Ÿ Ä‘Ã¢y lÃ  máº·c dÃ¹ ngÆ°á»i váº­n hÃ nh dá»‹ch vá»¥ sá»Ÿ há»¯u ObjectWrapper, nhÆ°ng khÃ´ng thá»ƒ truy cáº­p hoáº·c Ä‘Ã¡nh cáº¯p "Object" Ä‘Æ°á»£c wrap bÃªn trong nÃ³. Äiá»u nÃ y lÃ  do Sui khÃ´ng cho phÃ©p truy cáº­p vÃ o object Ä‘Ã£ Ä‘Æ°á»£c wrap mÃ  khÃ´ng cÃ³ má»™t function unwrap cá»¥ thá»ƒ.

## **Wrapping quaÂ `Option`**

Trong vÃ­ dá»¥ Direct wrapping á»Ÿ trÃªn, báº¡n pháº£i destroy má»™t object Ä‘á»ƒ láº¥y Ä‘Æ°á»£c **object bÃªn trong nÃ³** ra. Tuy nhiÃªn, Ä‘Ã´i khi ta cáº§n sá»± linh hoáº¡t hÆ¡n, khi mÃ  wrapping  khÃ´ng pháº£i lÃºc nÃ o cÅ©ng chá»©a wrapped object bÃªn trong nÃ³, vÃ  báº¡n cÃ³ thá»ƒ thay tháº¿ wrapped object báº±ng má»™t object khÃ¡c khi cáº§n thiáº¿t.

Láº¥y vÃ­ dá»¥ mÃ¬nh Ä‘á»‹nh nghÄ©a má»™t `Simplewarrior` vá»›i option cÃ³ thá»ƒ cÅ©ng cÃ³ thá»ƒ khÃ´ng vá»›i kiáº¿m `sword` hay `shield:` 

```rust
public struct SimpleWarrior has key {
    id: UID,
    sword: Option<Sword>,
    shield: Option<Shield>,
}

public struct Sword has key, store {
    id: UID,
    strength: u8,
}

public struct Shield has key, store {
    id: UID,
    armor: u8,
}
```

NhÆ° váº­y khi táº¡o má»™t warrior, báº¡n cÃ³ thá»ƒ báº¯t Ä‘áº§u vá»›i khÃ´ng cÃ³ báº¥t kÃ¬ equipment nÃ o: 

```rust
public entry fun create_warrior(ctx: &mut TxContext) {
    let warrior = SimpleWarrior {
        id: object::new(ctx),
        sword: option::none(),
        shield: option::none(),
    };
    transfer::transfer(warrior, tx_context::sender(ctx))
}
```

Táº¡o `Sword` 

```rust
public entry fun create_sword(strength: u8, ctx: &mut TxContext) {
    let sword = Sword { 
        id: object::new(ctx),
        strength
    };

    transfer::transfer(sword, tx_context::sender(ctx))

}
```

NhÆ°ng mÃ  giá» thÃ¬ báº¡n muá»‘n thay Ä‘á»•i chiáº¿n binh cá»§a báº¡n sáº½ cÃ³ kiáº¿m Ä‘Ãºng khÃ´ng? thÃ¬ ta chá»‰ cáº§n viáº¿t má»™t function thay Ä‘á»•i giÃ¡ trá»‹ trong Ä‘Ã³. Náº¿u cÃ³ kiáº¿m sáºµn á»Ÿ trong object thÃ¬ mÃ¬nh sáº½ láº¥y ra vÃ  transfer Ä‘áº¿n vá»›i sender rá»“i wrap má»™t thanh kiáº¿m má»›i: 

```rust
public entry fun equip_sword(warrior: &mut SimpleWarrior, sword: Sword, ctx: &mut TxContext) {
    if (option::is_some(&warrior.sword)) {
        let old_sword = option::extract(&mut warrior.sword);
        transfer::transfer(old_sword, tx_context::sender(ctx));
    };
    
    option::fill(&mut warrior.sword, sword);
}
```

## Wrapping thÃ´ng qua vector

Trong Sui, ta cÃ²n cÃ³ cÃ¡ch Ä‘á»ƒ wrap cÃ¡c objects chÃ­nh lÃ  dÃ¹ng vector, tÆ°Æ¡ng tá»± nhÆ° `Option`  type. CÃ¡ch nÃ y cÃ³ thá»ƒ giÃºp báº¡n chá»©a má»™t hoáº·c nhiá»u objects cÃ¹ng má»™t type. 

VÃ­ dá»¥ `Warrior` cÃ³ trang bá»‹ nhiá»u kiáº¿m `Sword` vÃ  `Shield`

```rust
public struct SimpleWarrior has key {
    id: UID,
    swords: vector<Sword>,
    shields: vector<Shield>,
}
```


## Object unwrapping

Trong trÆ°á»ng há»£p unwrapping (thÃ¡o gá»¡), má»™t cÃ¡ch phá»• biáº¿n lÃ  ta táº¡o hÃ m unwrap, Ä‘áº§u vÃ o má»™t object sau Ä‘Ã³ tráº£ vá» object táº¡i Ä‘á»‹a chá»‰ Ä‘Ã³, tá»« Ä‘Ã³ giÃºp thÃ¡o gá»¡ object ra khá»i wrapping object.

```tsx
public struct ObjectWrapper has key {
    id: UID,
    original_owner: address,
    to_swap: Object,
    fee: Balance<SUI>,
}

public entry fun unwrapped_object_and_transfer(object_wrrapper: ObjectWrapper, ctx: &mut TContext)!
	let ObjectWrapper {
	id,
	original_owner,
	to_swap: -.
	fee
	} = object_wrrapper;
	transfer::transfer(original_owner, tx_context:: sender(ctx));
	
	// delete original_owner
	object :: delete(id)
	
}
```


